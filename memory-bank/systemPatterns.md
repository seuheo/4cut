# KTX ë„¤ì»· ì•± - ì‹œìŠ¤í…œ íŒ¨í„´

## ğŸ—ï¸ ì•„í‚¤í…ì²˜ ê°œìš”

### ì „ì²´ ì‹œìŠ¤í…œ êµ¬ì¡°
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Presentation Layer                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚   MainScreen    â”‚  â”‚   PhotoGrid     â”‚  â”‚ ActionBtns  â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ViewModel Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                  MainViewModel                          â”‚ â”‚
â”‚  â”‚  - UI State Management                                 â”‚ â”‚
â”‚  â”‚  - Business Logic                                      â”‚ â”‚
â”‚  â”‚  - User Actions                                        â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Repository Layer                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚                PhotoRepository                          â”‚ â”‚
â”‚  â”‚  - Data Operations                                     â”‚ â”‚
â”‚  â”‚  - State Flow Management                               â”‚ â”‚
â”‚  â”‚  - Data Consistency                                    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Data Layer                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”‚
â”‚  â”‚     Photo       â”‚  â”‚   ImageProc     â”‚  â”‚  FileMgr    â”‚ â”‚
â”‚  â”‚   (Model)       â”‚  â”‚   (Utils)       â”‚  â”‚  (Utils)    â”‚ â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

## ğŸ”„ í•µì‹¬ ë””ìì¸ íŒ¨í„´

### 1. MVVM (Model-View-ViewModel)
```kotlin
// ViewModelì—ì„œ UI ìƒíƒœ ê´€ë¦¬
class MainViewModel : ViewModel() {
    private val _uiState = MutableStateFlow(MainUiState())
    val uiState: StateFlow<MainUiState> = _uiState.asStateFlow()
    
    // UI ìƒíƒœ ì—…ë°ì´íŠ¸
    fun updateState(newState: MainUiState) {
        _uiState.value = newState
    }
}

// Composableì—ì„œ ìƒíƒœ êµ¬ë…
@Composable
fun MainScreen(viewModel: MainViewModel = viewModel()) {
    val uiState by viewModel.uiState.collectAsState()
    // UI ë Œë”ë§
}
```

### 2. Repository Pattern
```kotlin
class PhotoRepository {
    private val _photos = MutableStateFlow<List<Photo>>(emptyList())
    val photos: StateFlow<List<Photo>> = _photos.asStateFlow()
    
    fun updatePhotos(newPhotos: List<Photo>) {
        _uiState.value = newPhotos
    }
}
```

### 3. State Hoisting
```kotlin
// ìƒíƒœë¥¼ ìƒìœ„ ì»´í¬ë„ŒíŠ¸ë¡œ ëŒì–´ì˜¬ë¦¼
@Composable
fun PhotoGrid(
    photos: List<Photo>,
    onPhotoClick: (Int) -> Unit,  // ìƒíƒœ ë³€ê²½ ì½œë°±
    modifier: Modifier = Modifier
) {
    // UI ë Œë”ë§ë§Œ ë‹´ë‹¹
}
```

## ğŸ¨ UI íŒ¨í„´

### 1. Compose UI êµ¬ì¡°
```kotlin
// ë©”ì¸ í™”ë©´ êµ¬ì¡°
@Composable
fun MainScreen() {
    Scaffold(
        topBar = { TopAppBar() },
        modifier = Modifier
    ) { innerPadding ->
        Column {
            PhotoGrid(modifier = Modifier.weight(1f))
            ActionButtons()
        }
    }
}
```

### 2. ê·¸ë¦¬ë“œ ë ˆì´ì•„ì›ƒ íŒ¨í„´
```kotlin
LazyVerticalGrid(
    columns = GridCells.Fixed(2),  // 2ì—´ ê³ ì •
    horizontalArrangement = Arrangement.spacedBy(8.dp),
    verticalArrangement = Arrangement.spacedBy(8.dp)
) {
    itemsIndexed(photos) { index, photo ->
        PhotoGridItem(photo, index, onClick)
    }
}
```

### 3. Material Design 3 ì»´í¬ë„ŒíŠ¸
```kotlin
// ì¹´ë“œ ê¸°ë°˜ UI
Card(
    elevation = CardDefaults.cardElevation(defaultElevation = 4.dp),
    colors = CardDefaults.cardColors(
        containerColor = MaterialTheme.colorScheme.surface
    )
) {
    // ì½˜í…ì¸ 
}
```

## ğŸ”„ ìƒíƒœ ê´€ë¦¬ íŒ¨í„´

### 1. StateFlow ì‚¬ìš©
```kotlin
// ë‹¨ë°©í–¥ ë°ì´í„° í”Œë¡œìš°
private val _uiState = MutableStateFlow(MainUiState())
val uiState: StateFlow<MainUiState> = _uiState.asStateFlow()

// ìƒíƒœ ì—…ë°ì´íŠ¸
fun updateState(update: (MainUiState) -> MainUiState) {
    _uiState.value = update(_uiState.value)
}
```

### 2. UI ìƒíƒœ ëª¨ë¸
```kotlin
data class MainUiState(
    val photos: List<Photo> = emptyList(),
    val isSaving: Boolean = false,
    val isSharing: Boolean = false,
    val errorMessage: String? = null
)
```

### 3. ìƒíƒœ ë³€ê²½ ì²˜ë¦¬
```kotlin
// ë¡œë”© ìƒíƒœ ê´€ë¦¬
fun savePhotos() {
    _uiState.value = _uiState.value.copy(isSaving = true)
    
    viewModelScope.launch {
        try {
            // ì €ì¥ ë¡œì§
            _uiState.value = _uiState.value.copy(isSaving = false)
        } catch (e: Exception) {
            _uiState.value = _uiState.value.copy(
                isSaving = false,
                errorMessage = e.message
            )
        }
    }
}
```

## ğŸ–¼ï¸ ì´ë¯¸ì§€ ì²˜ë¦¬ íŒ¨í„´

### 1. ì´ë¯¸ì§€ ë¡œë”© (Coil)
```kotlin
AsyncImage(
    model = photo.uri,
    contentDescription = "Photo ${index + 1}",
    contentScale = ContentScale.Crop,
    modifier = Modifier.fillMaxWidth()
)
```

### 2. ì´ë¯¸ì§€ í•©ì„± (Canvas API)
```kotlin
// 4ì»· ì´ë¯¸ì§€ë¥¼ í•˜ë‚˜ë¡œ í•©ì„±í•˜ëŠ” íŒ¨í„´
fun combinePhotos(photos: List<Bitmap>): Bitmap {
    val resultBitmap = Bitmap.createBitmap(
        totalWidth, totalHeight, Bitmap.Config.ARGB_8888
    )
    val canvas = Canvas(resultBitmap)
    
    photos.forEachIndexed { index, photo ->
        // ê° ì‚¬ì§„ì„ ì ì ˆí•œ ìœ„ì¹˜ì— ê·¸ë¦¬ê¸°
        val rect = calculateRect(index)
        canvas.drawBitmap(photo, null, rect, null)
    }
    
    return resultBitmap
}
```

## ğŸ” ê¶Œí•œ ê´€ë¦¬ íŒ¨í„´

### 1. Activity Result Contracts
```kotlin
// ê¶Œí•œ ìš”ì²­
private val requestPermissionLauncher = registerForActivityResult(
    ActivityResultContracts.RequestPermission()
) { isGranted ->
    if (isGranted) {
        // ê¶Œí•œ ìŠ¹ì¸ ì‹œ ì²˜ë¦¬
    } else {
        // ê¶Œí•œ ê±°ë¶€ ì‹œ ì²˜ë¦¬
    }
}
```

### 2. ê¶Œí•œ ìƒíƒœ ê´€ë¦¬
```kotlin
sealed class PermissionState {
    object Granted : PermissionState()
    object Denied : PermissionState()
    object Requesting : PermissionState()
}
```

## ğŸ§ª í…ŒìŠ¤íŠ¸ íŒ¨í„´

### 1. ViewModel í…ŒìŠ¤íŠ¸
```kotlin
@Test
fun `ì‚¬ì§„ ì €ì¥ ì‹œ ë¡œë”© ìƒíƒœê°€ trueë¡œ ë³€ê²½ëœë‹¤`() = runTest {
    // Given
    val viewModel = MainViewModel()
    
    // When
    viewModel.savePhotos()
    
    // Then
    assertTrue(viewModel.uiState.value.isSaving)
}
```

### 2. Compose UI í…ŒìŠ¤íŠ¸
```kotlin
@Test
fun `4ì»· ê·¸ë¦¬ë“œê°€ ì˜¬ë°”ë¥´ê²Œ í‘œì‹œëœë‹¤`() {
    composeTestRule.setContent {
        PhotoGrid(photos = testPhotos, onPhotoClick = {})
    }
    
    composeTestRule.onNodeWithText("Photo 1").assertIsDisplayed()
    composeTestRule.onNodeWithText("Photo 2").assertIsDisplayed()
    composeTestRule.onNodeWithText("Photo 3").assertIsDisplayed()
    composeTestRule.onNodeWithText("Photo 4").assertIsDisplayed()
}
```

## ğŸ“± í”Œë«í¼ íŠ¹í™” íŒ¨í„´

### 1. Android ìƒëª…ì£¼ê¸° ê´€ë¦¬
```kotlin
class MainViewModel : ViewModel() {
    override fun onCleared() {
        super.onCleared()
        // ë¦¬ì†ŒìŠ¤ ì •ë¦¬
    }
}
```

### 2. ì—ëŸ¬ ì²˜ë¦¬ íŒ¨í„´
```kotlin
sealed class Result<out T> {
    data class Success<T>(val data: T) : Result<T>()
    data class Error(val message: String) : Result<Nothing>()
    object Loading : Result<Nothing>()
}
```

### 3. ë©”ëª¨ë¦¬ ê´€ë¦¬
```kotlin
// Bitmap ì¬ì‚¬ìš©
private var cachedBitmap: WeakReference<Bitmap>? = null

fun processImage(): Bitmap {
    cachedBitmap?.get()?.let { return it }
    
    val newBitmap = createNewBitmap()
    cachedBitmap = WeakReference(newBitmap)
    return newBitmap
}
```
